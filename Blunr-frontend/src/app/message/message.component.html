<app-home-page-area>
  <app-home-sidebar></app-home-sidebar>
  <div
    class="home-container"
    [class.flex-row]="userChatRooms.length > 0"
    [class.open-msg]="isChatisOpened"
  >
    @if (userChatRooms.length > 0) {
      <div class="chat-list">
        <div class="chat-header">Messages</div>
        <div class="chat-body">
          @for (room of userChatRooms; track $index) {
            <div class="chat-tile" (click)="openChatOfUser(room._id)">
              <div class="chat-link">
                <div class="profile-opt">
                  <img
                    [src]="getAvatarForRoom(room)"
                    class="navbar-icon profile-opt"
                    alt="icon"
                  />
                  @if (room.unreadCount > 0) {
                    <div class="unread-badge">{{ room.unreadCount }}</div>
                  }
                </div>
                <div class="d-flex flex-column">
                  <div class="nams-username d-flex position-relative">
                    <span 
                      class="display-name-container"
                      (contextmenu)="changeDisplayName(room, $event); $event.preventDefault()"
                      title="Right-click to change display name">
                      {{ getDisplayNameForRoom(room) }}
                    </span>
                    <button 
                      type="button"
                      class="btn btn-sm btn-outline-secondary ms-2 change-name-btn"
                      (click)="changeDisplayName(room, $event)"
                      title="Change display name"
                      [attr.aria-label]="'Change display name for ' + getUsernameForRoom(room)">
                      <svg width="12" height="12" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                      </svg>
                    </button>
                  </div>
                  <div class="last-msg" [class.unread-text]="room.unreadCount > 0">
                    {{ room?.lastMessage?.text }}
                  </div>
                </div>
                <div class="chat-time-container">
                  <div class="chat-time">{{ formatDate(room?.lastMessage?.timestamp) }}</div>
                  @if (room.unreadCount > 0) {
                    <div class="unread-dot"></div>
                  }
                </div>
              </div>
            </div>
          } @empty {
            <app-empty-data
              [message]="'You haven\u0027t subscribed to any creators yet.'"
            ></app-empty-data>
          }
        </div>
      </div>

      @if (isChatisOpened) {
        <app-chatbot 
          style="width: 100%" 
          (goChatBackEvent)="goChatBack()"
          (messageSentEvent)="loadUserChatRooms()">
        </app-chatbot>
      } @else {
        <ng-container *ngTemplateOutlet="noUsersSelected"></ng-container>
      }
    } @else {
      <app-empty-data
        [message]="'You haven\u0027t subscribed to any creators yet.'"
      ></app-empty-data>
    }
  </div>
</app-home-page-area>

<ng-template #noUsersSelected>
  <div class="chat-list no-chat">
    <div class="no-msg">
      <p>No Users Selected.</p>
    </div>
  </div>
</ng-template>
